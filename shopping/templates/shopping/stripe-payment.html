{% load carton_tags %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Bootstrap 101 Template</title>

    <!-- Bootstrap -->

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    
   <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

<!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

<!-- Latest compiled and minified JavaScript -->

    <script src="https://js.braintreegateway.com/js/braintree-2.30.0.min.js"></script>

    <link rel="stylesheet" type="text/css" href="{% static 'suppbuilder/homepage.css' %}"/>
	<link rel="stylesheet" type="text/css" href="{% static 'shopping/payment.css' %}">
  </head>




</body>
<div class='container'>
	<div class='row'>
		<div class='col-lg-12' id='checkout-title'>
			<h1> Suppbuilder Checkout </h1>
			<ol class="breadcrumb">
			  <li class="active">Multivitamin</li>
			  <li><a href="{% url 'energy' %}">Pre-workout</a></li>
			  <li><a href="#">Protein</a></li>
			</ol>  
			<br>
		</div>
	</div>
</div>

<div class='container'>
	<div class='row'>
		<div class='col-lg-6 col-md-4' id='order-column'>
			<div class='row'>
				<div class='col-lg-12' id='shipping-row'>

					<h3> Shipping address</h3>
					
					{% if user.is_authenticated %}
						<a href="{% url 'update' %}">Change</a>
						<p>{{shipping_address.first_name}} {{shipping_address.last_name}}</p>
						<p>{{shipping_address.street_address}} <p>
						<p>{{shipping_address.city}}, {{shipping_address.state}} {{shipping_address.zip_code}}</p>
					{% endif %}

					{% if user.is_anonymous %}
					<a href="{% url 'edit-guest-address' %}">Edit</a>
					<p>{{guest_first_name}} {{guest_last_name}}</p>
					<p>{{guest_street_address}} <p>
					<p>{{guest_city}}, {{guest_state}} {{guest_zip}}</p>
					{% endif %}

				</div>
			</div>
			<hr>
			<div class='row'>
				<div class='col-lg-12 col-xs-12' id='order-summary'>
					<h3>Items and Shipping</h3>
				</div>
			</div>
			<div class='row'>
				<div class='col-lg-5' id='cart-block'>
					<h4>Cart items</h4>
					{% get_cart as cart %}
					{% for item in cart.items %}
						<ul class='list'>
							<li>{{ item.product.title}} {{item.product.serving_size}}</li>
						</ul>
					{% endfor %}
				</div>
				<div class='col-lg-7' id='shipping-block'>
					<h4>Shipping options</h4>

					{% for option in shipping_options %}
						<div class="radio">
							{% if option.id == order.selected_shipping_method %}
						  		<input type="radio" name="shipping" value={{option.amount}} id='{{option.id}}' checked='checked'><span>{{option.description}} ${{option.amount}} </span>
						  		<p>Delivery estimate : {{option.delivery_estimate}}</p>
						  	{% else %}
								<input type="radio" name="shipping" value={{option.amount}} id='{{option.id}}' ><span>{{option.description}} ${{option.amount}} </span>
								<p>Delivery estimate : {{option.delivery_estimate}}</p>
						  	{% endif %}
						</div>
					{% endfor %}
  
				</div>
			</div>
		</div>
		<div class='col-lg-5 col-md-4' id='payment-column'>
			<div class='row'>
				<div class='col-lg-12'>
					<h3>Order Summary</h3>
				</div>
			</div>

			<div class='row ordersummary'>
				<div class='col-lg-6 col-xs-5'>
					<p>Items (<span id='cart-counter'>{{cart_count}}</span>):</p>
					<p>Shipping & Handling:</p>
					<p>Tax:</p>
					<p id='discount-title'></p>
					<div id='discount-section'>
						{% if discount %}
							<p>Discount applied!</p>
						{% else %}
							<input id='discount-code' type='text' class='form-control' value='' placeholder='discount code'>
							<button id='discount' class='btn btn-info'>Apply discount</button>							
						{% endif %}
					</div>					
				</div>
				<div class='col-lg-6 col-xs-4'>
					<p id='item-cost'>$ <span id='item-total'>{{cart.total}}</span></p>
					<p>$ <span id='shipping-price'>{{default_shipping_amount}}</span></p>
					<p>$ {{tax_amount}} <p>
					{% if discount %}
						<p>$ {{discount_amount}}</p>
					{% else %}
						<p id='discount-amount'></p>
					{% endif %}
					
				</div>
			</div>

			<div class='row'>
				<div class='col-lg-4 col-xs-5'>
					<h3>Order total:</h3>	
				</div>
				<div class='col-lg-4 col-xs-4'>
					<h3>$ <span id='cart-total'>{{order_amount}}</span></h3>	
				</div>
			</div>
			<div class='row'>
				<div class='col-lg-12'>
					{% if user.is_anonymous %}
						<form action="{% url 'stripe-payment-view' %}" method="POST" id='stripe-form'>
							{% csrf_token %}
						<input type='text' style="display: none;" id="order-id" value="{{order.id}}"> 
						  <script
						    src="https://checkout.stripe.com/checkout.js" class="stripe-button"
						    data-key="pk_test_SlhO0v5tig7ZqVXXl0HzhZDV"
						    data-panel-label="Complete Order"
						    data-label="Pay with Stripe Checkout"
						    data-name="Suppbuilder"
						    data-description="Custom supplement stack"
						    data-image="https://stripe.com/img/documentation/checkout/marketplace.png"
						    data-locale="auto"
						    data-billing-address="true"
						    data-zip-code="true"
						    data-email="{{guest_email}}">
						  </script>
						</form>
					{% endif %}

					{% if user.is_authenticated %}
						<form action="{% url 'stripe-payment-view' %}" method="POST" id='stripe-form'>
							{% csrf_token %}
						<input type='text' style="display: none;" id="order-id" value="{{order.id}}"> 
						  <script
						    src="https://checkout.stripe.com/checkout.js" class="stripe-button"
						    data-key="pk_test_SlhO0v5tig7ZqVXXl0HzhZDV"
						    data-panel-label="Complete Order"
						    data-label="Pay with Stripe Checkout"
						    data-name="Suppbuilder"
						    data-description="Custom supplement stack for {{user.first_name}}"
						    data-image="https://stripe.com/img/documentation/checkout/marketplace.png"
						    data-locale="auto"
						    data-billing-address="true"
						    data-zip-code="true"
						    data-email="{{user.email}}">
						  </script>
						</form>
					{% endif %}
				</div>
			</div>
			<hr>
		</div>
	</div>
</div>

</body>



<footer>
	        <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
	    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
	    <!-- Include all compiled plugins (below), or include individual files as needed -->
	        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
	<!--     / <script src="js/bootstrap.min.js"></script> -->

	<script src="https://js.stripe.com/v2/"></script>
	<script src="https://js.stripe.com/v3/"></script>
	<script type="text/JavaScript" src="{% static 'shopping/payment.js' %}"></script>
	<script type="text/JavaScript" src="{% static 'shopping/accounting.js' %}"></script>
</footer>
</html>